<div class="dashboard">
  <h1>Dashboard Admin</h1>

  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <p>Chargement...</p>
  </div>

  <div class="cards" *ngIf="!loading && !error">
    <div class="card">
      <div class="label">Boxes (total)</div>
      <div class="value">{{ totalBoxes }}</div>
    </div>

    <div class="card">
      <div class="label">Boutiques sur des box (prises)</div>
      <div class="value">{{ takenBoxes }}</div>
    </div>
  </div>

  <!-- Abonnements KPI -->
  <div class="kpi-section" *ngIf="!loading && !error">
    <h2>ðŸ“Š Abonnements</h2>
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-value">{{ totalSubscriptions }}</div>
        <div class="kpi-label">Total abonnements</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value">{{ totalPaidThisMonth | currency:'MGA':'symbol':'1.0-0' }}</div>
        <div class="kpi-label">PayÃ© ce mois</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value">{{ totalUnpaidThisMonth | currency:'MGA':'symbol':'1.0-0' }}</div>
        <div class="kpi-label">Non payÃ© ce mois</div>
      </div>
    </div>
  </div>

  <!-- Graphique camembert PayÃ©/Non payÃ© -->
  <div class="chart-section" *ngIf="!loading && !error && chartData.total > 0">
    <h2>ðŸ“ˆ RÃ©partition PayÃ© / Non payÃ© ce mois</h2>
    <div class="chart-container">
      <svg width="200" height="200" viewBox="0 0 200 200">
        <!-- Paid slice -->
        <circle
          cx="100"
          cy="100"
          r="80"
          fill="none"
          stroke="#10b981"
          stroke-width="40"
          [attr.stroke-dasharray]="paidPercentage * 2.51 + ' 251'"
          stroke-dashoffset="0"
          transform="rotate(-90 100 100)"
        />
        <!-- Unpaid slice -->
        <circle
          cx="100"
          cy="100"
          r="80"
          fill="none"
          stroke="#ef4444"
          stroke-width="40"
          [attr.stroke-dasharray]="unpaidPercentage * 2.51 + ' 251'"
          [attr.stroke-dashoffset]="'-' + (paidPercentage * 2.51)"
          transform="rotate(-90 100 100)"
        />
        <!-- Center text -->
        <text x="100" y="105" text-anchor="middle" font-size="24" font-weight="bold" fill="#111827">
          {{ paidPercentage }}%
        </text>
      </svg>
      <div class="chart-legend">
        <div class="legend-item">
          <span class="legend-color" style="background:#10b981;"></span>
          <span>PayÃ© ({{ paidPercentage }}%)</span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background:#ef4444;"></span>
          <span>Non payÃ© ({{ unpaidPercentage }}%)</span>
        </div>
      </div>
    </div>
  </div>
</div>
